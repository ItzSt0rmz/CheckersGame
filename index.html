<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkers Game</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #383838;
        }
        table {
            border-collapse: collapse;
        }
        td {
            width: 50px;
            height: 50px;
            text-align: center;
            vertical-align: middle;
            font-size: 24px;
            cursor: pointer;
        }
        .black {
            background-color: gold;
        }
        .white {
            background-color: white;
        }
        .red-piece {
            color: white;
        }
        .black-piece {
            color: dark blue;
        }
        .red-king{
            color: dark blue;
        }
        .black-king{
            color: white;
        }
        .selected {
            background-color: DodgerBlue;
        }
    </style>
</head>
<body>
    <table id="board"></table>

    <script>
        const boardSize = 8;
        const board = document.getElementById('board');
        let selectedPiece = null;
        let currentPlayer = 'red';

        function createBoard() {
            for (let row = 0; row < boardSize; row++) {
                const tr = document.createElement('tr');
                for (let col = 0; col < boardSize; col++) {
                    const td = document.createElement('td');
                    td.id = `${row}-${col}`;
                    td.className = (row + col) % 2 === 0 ? 'white' : 'black';

                    if (td.className === 'black') {
                        if (row < 3) {
                            td.innerHTML = '&#128309;'; // Blue piece
                            td.classList.add('red-piece');
                        } else if (row > 4) {
                            td.innerHTML = '&#x26AA;'; // White piece
                            td.classList.add('black-piece');
                        }
                    }

                    td.addEventListener('click', () => handleCellClick(row, col));
                    tr.appendChild(td);
                }
                board.appendChild(tr);
            }
        }

        function handleCellClick(row, col) {
            const cell = document.getElementById(`${row}-${col}`);

            if (selectedPiece) {
                const [selectedRow, selectedCol] = selectedPiece;
                if (isValidMove(selectedRow, selectedCol, row, col)) {
                    movePiece(selectedRow, selectedCol, row, col);
                    selectedPiece = null;
                } else {
                    clearSelection();
                }
            } else if ( (cell.classList.contains(`${currentPlayer}-piece`)) || (cell.classList.contains(`${currentPlayer}-king`))) {
                selectedPiece = [row, col];
                cell.classList.add('selected');
            }
        }

        function isValidMove(fromRow, fromCol, toRow, toCol) {
            const fromCell = document.getElementById(`${fromRow}-${fromCol}`);
            const toCell = document.getElementById(`${toRow}-${toCol}`);
            const isKing = fromCell.classList.contains(`${currentPlayer}-king`);

            if (toCell.className !== 'black' || toCell.innerHTML) {
                return false;
            }

            const rowDiff = toRow - fromRow;
            const colDiff = Math.abs(toCol - fromCol);
            const direction = currentPlayer === 'red' ? 1 : -1;

            if (rowDiff === direction && colDiff === 1) {
                return true;
            }
            
            if (isKing === true && (colDiff === 1 || colDiff === -1)) {
                return true;
            }

            if (rowDiff === 2 * direction && colDiff === 2) {
                const middleRow = (fromRow + toRow) / 2;
                const middleCol = (fromCol + toCol) / 2;
                const middleCell = document.getElementById(`${middleRow}-${middleCol}`);

                if (middleCell.classList.contains(currentPlayer === 'red' ? 'black-piece' : 'red-piece')) {
                    middleCell.innerHTML = '';
                    middleCell.classList.remove('red-piece', 'black-piece');
                    return true;
                }
            }
            
            if (isKing === true && (colDiff === 2 || colDiff === -2)) {
                const middleRow = (fromRow + toRow) / 2;
                const middleCol = (fromCol + toCol) / 2;
                const middleCell = document.getElementById(`${middleRow}-${middleCol}`);

                if (middleCell.classList.contains(currentPlayer === 'red' ? 'black-piece' : 'red-piece')) { // BUG: can only jump pieces, not kings
                    middleCell.innerHTML = '';
                    middleCell.classList.remove('red-piece', 'black-piece', 'red-king', 'black-king');
                    return true;
                }
            }
            
            return false;
        }

        function movePiece(fromRow, fromCol, toRow, toCol) {
            const fromCell = document.getElementById(`${fromRow}-${fromCol}`);
            const toCell = document.getElementById(`${toRow}-${toCol}`);
            const isKing = fromCell.classList.contains(`${currentPlayer}-king`);
          
            toCell.innerHTML = fromCell.innerHTML;
            if (isKing === true) {toCell.classList.add(`${currentPlayer}-king`);}
            if (isKing === false) {toCell.classList.add(`${currentPlayer}-piece`);}
            fromCell.innerHTML = '';
            fromCell.classList.remove('selected', `${currentPlayer}-piece`, `${currentPlayer}-king`);

            if ((currentPlayer === 'red' && toRow === boardSize - 1) || (currentPlayer === 'black' && toRow === 0)) {
                toCell.classList.remove('red-piece', 'black-piece');
                if (currentPlayer === 'red') {
                  toCell.innerHTML = '&#9813;'; // red king
                  toCell.classList.add('red-king');
                }
                if (currentPlayer === 'black') {
                  toCell.innerHTML = '&#9813;'; // black king
                  toCell.classList.add('black-king');
                }
            }
            
            // add double jump option

            switchPlayer();
        }

        function clearSelection() {
            if (selectedPiece) {
                const [row, col] = selectedPiece;
                const cell = document.getElementById(`${row}-${col}`);
                cell.classList.remove('selected');
            }
            selectedPiece = null;
        }

        function switchPlayer() {
            currentPlayer = currentPlayer === 'red' ? 'black' : 'red'; // ternary operator (if cP = red, return black, else return red)
            clearSelection();
        }
        
        // function gameOver

        createBoard();
    </script>
</body>
</html>